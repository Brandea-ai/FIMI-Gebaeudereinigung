# Report R0006 - P0-15, P0-16, P0-17

**Datum:** 2025-12-06
**Tasks:** P0-15 (OG/Social), P0-16 (Error-Seiten), P0-17 (Security)
**Status:** ERLEDIGT
**Commit:** `07717d4`

---

## Zusammenfassung

| Task | Beschreibung | Dateien |
|------|--------------|---------|
| P0-15 | OG/Twitter + Favicons | 20 geändert |
| P0-16 | 404/500 Error-Seiten | 3 neu |
| P0-17 | Security-Headers | 1 geändert |

**Gesamt:** 24 Dateien bearbeitet

---

# P0-15: OG/Twitter + Favicons

## Problem

- `/og-image.jpg` existierte nicht (20 Dateien referenzierten es)
- Social Sharing funktionierte nicht
- Schema.org hatte falsches Bild

## Lösung

### Logo als temporäres OG-Image

**Bild:** `/FIMI-LOGO/FIMI-LOGO-WEIße_Schrift_mit-Hintergrund.png`
- Navy-Hintergrund (#012956)
- Weißes FIMI-Logo mit Schriftzug

### Geänderte Dateien (20)

**Global:**
- `app/layout.tsx` - OG, Twitter, Schema.org
- `app/page.tsx` - OG Image

**Leistungsseiten (Schema.org Image):**
- `app/leistungen/industriereinigung/page.tsx`
- `app/leistungen/unterhaltsreinigung/page.tsx`
- `app/leistungen/maschinenreinigung/page.tsx`
- `app/leistungen/hallenreinigung/page.tsx`
- `app/leistungen/sonderleistungen/page.tsx`
- `app/leistungen/facility-management/page.tsx`
- `app/leistungen/baureinigung/page.tsx`
- `app/leistungen/fensterreinigung/page.tsx`
- `app/leistungen/hausmeisterservice/page.tsx`
- `app/leistungen/winterdienst/page.tsx`
- `app/leistungen/aussenanlagenpflege/page.tsx`
- `app/leistungen/bueroreinigung/page.tsx`
- `app/leistungen/parkplatzreinigung/page.tsx`
- `app/leistungen/fassadenreinigung/page.tsx`
- `app/leistungen/beschaffungsmanagement/page.tsx`
- `app/leistungen/sonderreinigung/page.tsx`
- `app/leistungen/tiefgaragenreinigung/page.tsx`

### Nicht geändert (bereits korrekt)

- **OG-Images Leistungsseiten:** Nutzen Unsplash-Bilder
- **Favicons:** PNG in allen Größen konfiguriert

### Hinweis: Twitter vs X

Die Plattform heißt "X", aber die Meta-Tags bleiben `twitter:` (technischer Legacy-Name).

## DoD

| Kriterium | Status |
|-----------|--------|
| OG-Image existiert | OK |
| Twitter Card konfiguriert | OK |
| Favicons vorhanden | OK |
| Schema.org Images korrekt | OK |

---

# P0-16: 404/500 UX + Logging

## Problem

- Keine Error-Seiten vorhanden
- Standard Next.js Fehlerseite ohne Navigation
- Keine Kontaktmöglichkeit bei Fehlern

## Lösung

### Neue Dateien (3)

| Datei | Zweck |
|-------|-------|
| `app/not-found.tsx` | 404 - Seite nicht gefunden |
| `app/error.tsx` | 500 - Laufzeitfehler |
| `app/global-error.tsx` | Kritische Fehler im Root-Layout |

### Features

**404 (not-found.tsx):**
- FIMI CI-Farben (Navy/Türkis)
- Top 5 beliebte Seiten mit Links
- CTA: Startseite + Kontakt
- Telefonnummer anklickbar
- Responsive

**500 (error.tsx + global-error.tsx):**
- "Erneut versuchen" Button
- Startseite-Link als Fallback
- Telefonnummer für Support
- Error-Details nur in Development
- `console.error()` Logging

## DoD

| Kriterium | Status |
|-----------|--------|
| 404-Seite existiert | OK |
| Navigation vorhanden | OK |
| Kontakt CTA | OK |
| 500-Seite existiert | OK |
| Error Logging | OK |

---

# P0-17: Security-Headers Basis

## Problem

- Keine Security-Headers konfiguriert
- Kein Clickjacking-Schutz
- Keine HSTS
- Keine CSP

## Lösung

### Security-Headers in next.config.js

| Header | Wert | Zweck |
|--------|------|-------|
| X-DNS-Prefetch-Control | on | Performance |
| Strict-Transport-Security | max-age=63072000; includeSubDomains; preload | HTTPS |
| X-Frame-Options | DENY | Clickjacking |
| X-Content-Type-Options | nosniff | MIME-Sniffing |
| X-XSS-Protection | 1; mode=block | XSS (Legacy) |
| Referrer-Policy | strict-origin-when-cross-origin | Privacy |
| Permissions-Policy | camera=(), microphone=(), geolocation=() | Features |
| Content-Security-Policy | (siehe unten) | Ressourcen |

### Content-Security-Policy

```
default-src 'self';
script-src 'self' 'unsafe-inline' 'unsafe-eval' googletagmanager.com google-analytics.com;
style-src 'self' 'unsafe-inline' fonts.googleapis.com;
img-src 'self' data: blob: images.unsplash.com google-analytics.com;
font-src 'self' fonts.gstatic.com;
connect-src 'self' google-analytics.com analytics.google.com;
frame-ancestors 'none';
base-uri 'self';
form-action 'self';
```

### Geänderte Datei

- `next.config.js` - Security Headers Array

## DoD

| Kriterium | Status |
|-----------|--------|
| X-Frame-Options | OK |
| X-Content-Type-Options | OK |
| HSTS | OK |
| Referrer-Policy | OK |
| Permissions-Policy | OK |
| CSP | OK |

**Hinweis:** Test auf securityheaders.com nach HTTPS-Deployment.

---

## Empfehlungen für später

1. **OG-Image:** Dediziertes 1200x630px Bild erstellen (Logo + Slogan)
2. **Error Tracking:** Sentry für Production-Monitoring
3. **CSP:** Report-URI für CSP-Violations

---

# Git-Repository Reparatur

## Problem beim Push

Nach Abschluss der Tasks trat ein hartnäckiger Git-Fehler auf:
```
Schwerwiegend: mmap fehlgeschlagen: Operation timed out
```

## Ursache

1. **Korrupte Git-Referenzen** mit Leerzeichen im Namen:
   - `.git/refs/heads/main 2` (statt `main`)
   - `.git/refs/remotes/origin/main 2` (statt `main`)

2. **macOS Speicher-/Dateisystem-Problem**
   - mmap-Timeout deutet auf System-Level-Problem hin
   - Nicht durch Git-Reparatur lösbar

## Durchgeführte Reparaturen

| Aktion | Ergebnis |
|--------|----------|
| Korrupte Refs gelöscht (`main 2`) | OK |
| Remote-Ref repariert | OK |
| Git-Pack entpackt | OK |
| Push-Versuche (HTTPS) | Fehlgeschlagen (mmap) |
| Push-Versuch (SSH) | Fehlgeschlagen (Key nicht bei GitHub) |

## Lösung

**Mac neustarten**, dann:
```bash
cd ~/Desktop/FIMI-Gebaeudereinigung
git push origin main
```

## Lokale Commits (gesichert)

| Hash | Commit |
|------|--------|
| `07717d4` | feat: P0-15 bis P0-17 - OG/Social, Error-Pages, Security-Headers |
| `cf4ba24` | docs: R0006 Report finalisiert |

Diese Commits sind im lokalen Repository sicher und werden nach Neustart gepusht.

---

**Bearbeitet von:** Claude
**Session:** 2025-12-06
